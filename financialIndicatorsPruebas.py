openP=[6.90,7.06,6.91,6.96,6.97,7.01,6.91,6.99,7.66,7.87,7.93,8.13,8.47,8.48,8.53,8.48,8.70,8.70,8.64,8.61,8.56,8.62,8.35,8.16,8.45,8.54,8.62,8.69,8.69,8.94,8.99,8.90,9.03,8.95,8.89,8.92,8.88,8.90,8.81,8.56,8.29,8.53,8.49,8.31,8.21,8.16,8.23,8.35,8.29,8.16,8.46,8.50,8.64,8.70,8.74,8.46,8.78,8.86,8.59,8.89,8.77,8.75,8.76,8.61,8.64,8.17,8.68,8.98,9.06,9.05,9.17,9.19,9.19,9.40,9.20,9.33,9.52,9.49,9.48,9.72,9.75,9.68,9.79,9.94,9.98,9.96,9.91,9.75,9.87,9.87,9.81,9.88,10.03,10.11,10.20,10.13,10.06,9.96,9.95,9.94,10.14,10.04,9.84,9.78,9.78,9.64,9.75,9.73,9.80,9.70,9.70,9.65,9.59,9.60,9.64,9.59,9.80,9.94,9.98,10.06,10.30,10.22,10.17,10.26,10.18,10.03,9.97,9.85,9.90,9.93,10.06,9.96,10.04,9.90,9.78,10.28,10.25,10.36,10.56,10.47,10.49,10.35,10.37,10.51,10.44,10.62,10.58,10.60,10.74,10.44,10.41,10.49,10.60,10.57,10.59,10.60,10.54,10.64,10.37,10.20,10.19,10.24,10.20,10.19,10.19,10.21,10.01,9.97,10.09,10.06,9.96,10.01,9.96,10.09,10.04,9.97,10.01,10.06,9.95,9.90,9.82,9.96,10.00,9.86,9.92,9.74,9.75,9.79,9.81,9.84,9.82,9.80,9.76,9.72,9.66,9.49,9.71,9.80,9.84,9.91,9.89,9.82,9.67,9.80,9.60,9.33,9.19,9.22,9.03,8.99,9.03,8.91,9.10,9.07,8.95,8.81,9.14,9.03,9.15,9.16,9.27,9.28,9.09,8.98,8.86,9.04,8.99,9.05,9.11,8.99,8.90,8.90,8.94,8.99,9.00,8.75,8.88,8.82,8.83,8.96,8.70,8.54,8.53,8.59,8.59,8.79,8.64,8.73,8.67,8.87]
highP=[7.05,7.07,6.98,6.98,7.01,7.07,6.97,7.02,7.92,7.93,8.00,8.14,8.50,8.49,8.58,8.67,8.74,8.74,8.69,8.67,8.67,8.69,8.53,8.48,8.48,8.60,8.70,8.69,8.76,8.97,9.03,8.94,9.05,8.98,8.91,8.96,8.90,8.92,8.82,8.58,8.34,8.53,8.53,8.42,8.30,8.28,8.28,8.43,8.35,8.27,8.52,8.51,8.65,8.73,8.78,8.66,8.81,8.88,8.72,8.93,8.88,8.80,8.84,8.70,8.69,8.46,8.70,9.11,9.09,9.12,9.20,9.30,9.22,9.42,9.26,9.33,9.55,9.62,9.51,9.79,9.77,9.79,9.85,9.94,10.00,10.03,9.96,9.88,9.88,10.02,9.86,9.91,10.03,10.16,10.24,10.28,10.09,9.97,9.96,9.98,10.14,10.10,9.96,9.84,9.87,9.71,9.76,9.75,9.84,9.71,9.74,9.73,9.65,9.69,9.66,9.70,9.81,9.97,10.04,10.14,10.33,10.24,10.19,10.30,10.22,10.05,10.05,9.90,9.96,9.99,10.07,9.98,10.08,9.94,9.98,10.40,10.26,10.41,10.66,10.54,10.60,10.44,10.40,10.52,10.51,10.66,10.62,10.63,10.75,10.60,10.47,10.55,10.63,10.58,10.60,10.70,10.75,10.68,10.43,10.23,10.23,10.24,10.25,10.19,10.23,10.23,10.07,10.02,10.13,10.08,9.98,10.06,9.98,10.14,10.08,10.05,10.02,10.17,9.99,9.93,9.95,10.00,10.02,9.98,10.00,9.82,9.77,9.87,9.81,9.88,9.88,9.85,9.80,9.74,9.73,9.70,9.71,9.83,9.98,9.95,9.96,9.91,9.73,9.80,9.67,9.40,9.25,9.24,9.11,9.01,9.07,9.05,9.12,9.14,9.04,8.91,9.16,9.09,9.22,9.21,9.27,9.33,9.18,9.04,8.92,9.11,9.07,9.07,9.14,9.14,9.26,8.97,9.04,9.02,9.02,8.98,8.92,9.00,8.86,9.03,8.87,8.68,8.58,8.61,8.74,8.84,8.78,8.83,8.74,8.88]
lowP = [6.89,6.98,6.86,6.89,6.91,6.90,6.79,6.65,7.34,7.75,7.72,7.92,8.38,8.32,8.50,8.48,8.69,8.67,8.63,8.57,8.54,8.55,8.34,8.12,8.18,8.33,8.54,8.55,8.66,8.86,8.98,8.79,8.98,8.90,8.86,8.90,8.84,8.84,8.72,8.47,8.27,8.42,8.45,8.30,8.21,8.15,8.20,8.30,8.23,8.10,8.26,8.42,8.40,8.61,8.71,8.45,8.58,8.79,8.51,8.79,8.74,8.67,8.75,8.59,8.57,8.15,8.39,8.95,8.93,8.88,8.93,9.09,9.08,9.28,9.17,9.08,9.38,9.46,9.43,9.69,9.66,9.65,9.69,9.80,9.88,9.95,9.85,9.74,9.82,9.81,9.78,9.83,9.91,10.04,10.11,10.07,10.02,9.89,9.86,9.90,10.03,10.03,9.83,9.70,9.77,9.64,9.72,9.71,9.56,9.65,9.66,9.61,9.54,9.54,9.40,9.58,9.56,9.86,9.81,9.97,10.20,10.14,10.08,10.18,10.15,9.99,9.94,9.81,9.84,9.80,10.00,9.85,10.01,9.83,9.70,10.26,10.13,10.33,10.55,10.45,10.47,10.34,10.32,10.32,10.43,10.53,10.54,10.55,10.65,10.41,10.38,10.46,10.54,10.51,10.48,10.55,10.53,10.59,10.23,10.15,10.16,10.18,10.18,10.12,10.16,10.12,9.98,9.95,10.07,9.98,9.93,9.97,9.81,10.08,10.01,9.97,9.91,10.04,9.90,9.86,9.80,9.92,9.88,9.85,9.80,9.71,9.66,9.71,9.76,9.82,9.78,9.77,9.69,9.51,9.61,9.47,9.54,9.71,9.81,9.81,9.79,9.81,9.66,9.71,9.55,9.32,9.16,9.16,9.00,8.85,8.94,8.88,8.88,9.03,8.94,8.76,8.89,8.96,9.08,9.08,9.12,9.25,9.07,8.96,8.78,9.00,8.95,9.00,9.05,8.98,8.87,8.85,8.89,8.94,8.95,8.75,8.85,8.82,8.78,8.89,8.68,8.54,8.47,8.35,8.59,8.68,8.61,8.72,8.52,8.67]
closeP=[7.04,7.06,6.95,6.96,6.96,6.98,6.91,6.88,7.35,7.90,7.78,7.93,8.42,8.33,8.51,8.60,8.69,8.72,8.67,8.67,8.64,8.68,8.48,8.32,8.23,8.34,8.57,8.57,8.72,8.90,8.99,8.88,9.03,8.92,8.90,8.90,8.88,8.86,8.75,8.50,8.28,8.45,8.46,8.36,8.30,8.21,8.23,8.40,8.30,8.27,8.37,8.47,8.49,8.68,8.77,8.59,8.64,8.86,8.70,8.93,8.77,8.70,8.81,8.70,8.64,8.35,8.55,9.02,8.93,8.89,8.96,9.30,9.09,9.33,9.22,9.19,9.43,9.50,9.47,9.75,9.70,9.75,9.70,9.85,9.91,9.96,9.87,9.85,9.83,9.87,9.81,9.90,9.95,10.05,10.24,10.13,10.07,9.94,9.92,9.95,10.08,10.04,9.92,9.75,9.83,9.69,9.73,9.74,9.68,9.68,9.69,9.65,9.59,9.69,9.46,9.65,9.61,9.94,9.90,9.97,10.29,10.14,10.16,10.22,10.18,10.00,10.04,9.88,9.94,9.80,10.05,9.93,10.05,9.94,9.94,10.40,10.16,10.40,10.64,10.48,10.56,10.42,10.36,10.47,10.47,10.53,10.59,10.59,10.67,10.59,10.46,10.49,10.58,10.55,10.54,10.69,10.75,10.67,10.43,10.16,10.23,10.19,10.22,10.13,10.21,10.18,10.04,10.00,10.10,10.00,9.93,10.03,9.85,10.10,10.07,10.03,9.98,10.11,9.95,9.89,9.93,9.93,9.99,9.96,9.82,9.80,9.72,9.83,9.80,9.86,9.82,9.82,9.80,9.63,9.71,9.58,9.58,9.80,9.93,9.90,9.79,9.88,9.73,9.78,9.58,9.39,9.25,9.17,9.08,9.00,8.98,9.01,8.94,9.13,8.98,8.87,8.89,9.09,9.12,9.21,9.17,9.27,9.15,8.99,8.80,9.05,9.05,9.05,9.08,9.11,8.90,8.93,8.90,8.99,8.99,8.98,8.88,8.98,8.83,9.02,8.86,8.65,8.54,8.36,8.64,8.81,8.71,8.79,8.60,8.69]
volum=[17932722,13829587,10645173,15348406,18310767,19834209,20108681,59412179,68825411,8434078,10160182,21728724,6611039,9491129,10235187,6506213,3036006,2247582,4770618,6082828,13750859,7849021,13565137,14369678,12122258,9894870,6867469,8535459,8766564,15010001,7343735,10072110,11262605,27268234,9077052,6495827,7293940,13859304,13613554,17158922,7106478,13579938,19041103,13582463,6149661,9783789,9510612,6831929,5265290,10741629,12460698,26141768,12706755,5826830,9807832,16195512,15245101,17992171,39062615,5210324,14015947,10295088,14189864,11820870,8597491,14597369,16165413,8260768,6460751,7167679,9406286,7896313,7990081,7421512,9863248,14420583,10389823,17559372,12296106,11054285,8460597,10162644,6027866,6289906,8335511,10592751,6564061,8204341,4488266,6064992,5429890,5846911,7114325,3213890,6449798,7379975,5958355,5564166,4022238,4406152,4304610,4517644,2878426,2990139,3889552,2898460,3193741,2679946,7308473,3113916,5280720,8592442,4815684,7602997,9661231,6213931,13812660,6242870,17517254,8000618,8018969,9662120,6774735,5387213,7892379,6739985,3961400,3220841,4675480,7619087,4518538,6143041,4903681,5050673,15662804,7393981,7884761,5059766,3794076,5067000,7160925,4547020,8650721,5792414,5396441,4852625,3336513,6550122,4429539,5867285,3828711,10885349,9226954,5674523,4741713,7703248,10435165,16477167,19902657,9305602,4011086,4369189,6403527,5079589,5785474,7602992,5466992,3469869,5502500,6231895,3341378,4996953,10215066,5080090,3614586,4643269,5675784,9623441,8344093,2957804,4825034,4667023,5357832,8439846,11051770,3171949,3256846,3065226,2097584,2339449,2191702,2345670,3249256,5035709,5016428,4163951,5300936,6183401,5610498,6274345,8381467,4601083,4272586,7079072,6297716,5968468,3661416,6579445,9559594,5011891,5239458,4001217,6060688,3943026,5314694,10560690,7145626,4201088,3645716,2244555,3527190,6501804,4326672,6369780,6950645,3889612,2674041,3077767,4059182,7192286,3551939,2631014,5341678,2709752,5581008,4995661,5050639,4990582,9283436,4714196,4610474,5218892,4931269,7888545,8014996,6665198,6716722,6941635,8006519,13203922]

"""
Input:
	stockPrices : array of floats
	period : integer
	volume : array of floats
	shortPeriod: integer
	longPeriod: integer
	StockPricesHigh: array of floats
	StockPricesLow: array of floats
	MACDArray: array of floats
	array: array of floats
"""
import math

class FinancialService(object):

	"""
	-pre: len(stockPrices)!= 0 ^ 0<period<(len(StockPrices))
	-post: list with exponential moving average calculated 
	"""

	def ExponencialAverage(self,stockPrices,period):
		EMAList = []
		media = 0.0
		for i in range(period):
			media += stockPrices[i]
		media /= (period)
		listaMod = stockPrices[(period):]
		EMAList.append(media)
		div = (2.0/(period+1))
		for i in range(len(listaMod)):
			EMAList.append((listaMod[i]*div)+(EMAList[i]*(1-(div))))
		return EMAList

	"""
	-pre: len(stockPrices)!= 0 ^ 0<period<(len(stockPrices))
	-post: list with SMA calculated 
	"""

	def SMA(self,stockPrices,period):
		lf=[]
		media = 0.0
		p = period
		a = 0
		while (period <= len(stockPrices)):
			i = a
			while (i < period):
				media += (stockPrices[i])
				i = i+1
			lf.append(media/float(p))
			period = (period + 1)
			a = a +1 
			media = 0.0
		return(lf)

	"""
	-pre: len(StockHigh)==len(StockLow)==len(stockPrices) ^ len(stockPrices)!=0 ^ 0<period<(len(stockPrices))
	-post: list with ADX calculated 
	"""

	def ADX(self,StockPrices,StockPricesHigh,StockPricesLow,period):

		def calculoPeriodico(l):
			l_aux = []
			l_aux.append(sum(l[0:(period-1)]))
			i = 0
			j = (period-1)
			while j < len(l):
				l_aux.append(l_aux[i]-(l_aux[i]/period)+l[j])
				i += 1
				j += 1
			return l_aux

		def DIPeriodico(list1,list2):
			l_aux = []
			i = 0
			while i<len(list1):
				l_aux.append((list1[i]/list2[i])*100)
				i +=1
			return l_aux

		#CALCULO DE TR (True Range)
		tr = []
		i = 1
		while (i<len(StockPrices)):
			tr.append(max((StockPricesHigh[i]-StockPricesLow[i]),abs(StockPricesHigh[i]-StockPrices[i-1]),abs(StockPricesLow[i]-StockPrices[i-1])))
			i += 1

		#CALCULO DE ATR (como el True Range pero con periodo sapee)
		atr = calculoPeriodico(tr)

		#CALCULO PARA +DM
		dm_pos = []

		i = 1
		while i < len(StockPrices):
			if ((StockPricesHigh[i]-StockPricesHigh[i-1])>(StockPricesLow[i-1]-StockPricesLow[i])):
				dm_pos.append(max((StockPricesHigh[i]-StockPricesHigh[i-1]),(0)))
			else:
				dm_pos.append(0)
			i += 1

		#CALCULO PARA -DM
		dm_neg = []
		i = 1
		while i < len(StockPrices):
			if ((StockPricesLow[i-1]-StockPricesLow[i])>(StockPricesHigh[i]-StockPricesHigh[i-1])):
				dm_neg.append(max((StockPricesLow[i-1]-StockPricesLow[i]),(0)))
			else:
				dm_neg.append(0)
			i += 1

		#CALCULO PARA +Dm (pero con periodo biem peeolaa)
		dm_p = (calculoPeriodico(dm_pos))

		#CALCULO PARA -Dm (pero con periodo biem peeolaa)
		dm_n = (calculoPeriodico(dm_neg))

		# CALCULO PARA +DI (periodo)
		di_p = DIPeriodico(dm_p,atr);

		# CALCULO PARA -DI (periodo)
		di_n = DIPeriodico(dm_n,atr);

		# CALCULO PARA DX (wololo)
		dx = []
		for i in range(len(di_p)):
			dx.append(((abs(di_p[i]-di_n[i]))/(di_p[i]+di_n[i]))*100)

		#CALCULO PARA... chan charachaannnn ADX
		#https://www.youtube.com/watch?v=dQw4w9WgXcQ
		adxList = []
		i = 0
		suma = 0.0
		while i < len(di_p):
			suma += (dx[i])
			i += 1
		adxList.append(suma/len(di_p))
		i = 0
		j = period
		while i < len(dx[period:]):
			adxList.append((adxList[i]*(period-i)+dx[j])/(period))
			j += 1
			i += 1

		return adxList

	"""
	-pre: len(array) != 0
	-post: standard deviation of "array"
	"""

	def StandardDeviation(self,array):
		media=0.0
		desviacion=0.0
		for i in range(len(array)):
			media+=array[i]
		media/=len(array)
		for i in range(len(array)):
			desviacion+=(array[i]-media)**2		
		desviacion/=media
		return math.sqrt(desviacion)

	"""
	-pre: len(array) != 0
	-post: coefficient of variation of "array"
	"""

	def CoefficientOfVariation(self,array):
		media = 0.0
		for i in range(len(array)):
			media+=array[i]
		media /= len(array)
		desviacion=self.StandardDeviation(array)
		return desviacion/abs(media)

	"""
	-pre: len(StockPrice) != 0 ^ shortPeriod<=longPeriod ^ shortPeriod>0
	-post: list with MACD calculated 
	"""
		
	def MACD(self,stockPrices,shortPeriod,longPeriod):
		macdList = []
		list1 = (self.ExponencialAverage(stockPrices,shortPeriod)[(longPeriod-shortPeriod):])
		list2 = (self.ExponencialAverage(stockPrices,longPeriod))

		for i in range(len(list2)):
			macdList.append(list1[i]-list2[i])

		return macdList

	"""
	-pre: len(MACDArray) != 0 ^ period>0
	-post: list with Signal calculated 
	"""

	def Signal(self,MACDArray,period):
		return self.ExponencialAverage(MACDArray,period)

	"""
	-pre: len(StockPrice) != 0
	-post: list with OBV calculated 
	"""

	def OBV (self,StockPrice,volume):
		obvList = []
		obvList.append(volume[0])
		i = 2
		while i < (len(StockPrice)):
			if (StockPrice[i]>StockPrice[i-1]):
				obvList.append(obvList[i-2]+volume[i-1])
			if (StockPrice[i]<StockPrice[i-1]):
				obvList.append(obvList[i-2]-volume[i-1])
			elif (StockPrice[i]==StockPrice[i-1]):
				obvList.append(obvList[i-2]+0)
			i +=1
		return obvList

	"""
	-pre: len(StockHigh)==len(StockLow)==len(stockPrices) ^ len(stockPrices)!=0 ^ 0<period<(len(stockPrices))
	-post: list with CCI calculated 
	"""

	def CCI(self,StockPrices,StockPricesHigh,StockPricesLow,period):

		def obtener_periodo(array,periodo,num):
			a = ((len(array))-(periodo-1))
			i = 0
			lista = []
			while (i < a):
				lista.append(array[i:periodo+i])
				i = i+1
			return lista[num]

		stockTP = []
		stockTPD = []
		deviation = []
		stockCCI = []
		for i in range(len(StockPrices)):
			stockTP.append((StockPricesHigh[i]+StockPricesLow[i]+StockPrices[i])/3)
		stockTPD = self.SMA(stockTP,period)
		j = 0
		while (j < (len(stockTPD))):
			listaAuxiliar = []
			des = 0.0
			i = 0
			while (i<period):
				listaAuxiliar = obtener_periodo(stockTP,period,j)
				des += abs(stockTPD[j]-listaAuxiliar[i])
				i +=1
			des/=(period)
			deviation.append(des)
			j += 1
		l = (len(stockTP))-(len(stockTPD))
		listaMod = (stockTP[l:])
		for i in range(len(listaMod)):
			stockCCI.append((listaMod[i]-stockTPD[i])/(0.015*deviation[i]))
		return stockCCI

	"""
	-pre: len(StockHigh)==len(StockLow)==len(stockPrices) ^ len(stockPrices)!=0
	-post: list with stochastic K calculated 
	"""

	def K(self,StockPrices,StockPricesHigh,StockPricesLow):
		valMin = min(StockPricesLow)
		valMax = max(StockPricesHigh)
		estocasticoK = []
		for i in range(len(StockPrices)):
			estocasticoK.append(100*((StockPrices[i]-valMin)/(valMax-valMin)))
		return estocasticoK

	"""
	-pre: len(StockHigh)==len(StockLow)==len(stockPrices) ^ len(stockPrices)!=0 ^ 0<period<(len(stockPrices))
	-post: list with stochastic D calculated 
	"""

	def D(self,StockPrices,StockPricesHigh,StockPricesLow,period):
		return self.SMA(self.K(StockPrices,StockPricesHigh,StockPricesLow),period)


print len(closeP)
p = 14
while p <= 20:
	f = FinancialService()
	print("-------------MEDIA EXPONENCIAL--------------")
	print(f.ExponencialAverage(closeP,p))
	print("-------------MEDIA MOVIL SIMPLE--------------")
	print(f.SMA(closeP,p))
	print("-------------ADX--------------")
	print(f.ADX(closeP,highP,lowP,p))
	print("-------------DESVIACION ESTANDAR--------------")
	print(f.StandardDeviation(openP))
	print("-------------COEFICIENTE DE VARIACION--------------")
	print(f.CoefficientOfVariation(openP))
	# print("-------------MACD--------------")
	# print(f.MACD(closeP,20,45))
	# print("-------------SENAL--------------")
	# print(f.Signal(f.MACD(closeP,20,45),p))
	print("-------------OBV--------------")
	print(f.OBV(closeP,volum))
	print("-------------CCI--------------")
	print(f.CCI(closeP,highP,lowP,p))
	print("-------------K--------------")
	print(f.K(closeP,highP,lowP))
	print("-------------D--------------")
	print(f.D(closeP,highP,lowP,p))
	print("----------------------------------------------------------------------------------------------------------------------------")
	p += 1
